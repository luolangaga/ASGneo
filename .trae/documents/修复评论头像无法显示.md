## 问题分析
- 评论返回的 `authorAvatarUrl` 目前在服务层生成的是相对路径（如 `/avatars/{userId}/avatar.jpg`）。
- 前端运行在与 API 不同的域名时，直接使用相对路径会指向前端域，导致 404 或被浏览器拦截（HTTPS/混合内容）。
- `UsersController` 的头像生成方法会返回绝对 URL（带协议与主机），而 `ArticleService` 返回的是相对路径，造成不一致。

## 后端修复
1. 在 `ArticleService` 中统一头像 URL 生成为绝对路径：
   - 注入 `IHttpContextAccessor`，在 `GetAvatarUrl(userId)` 中读取当前请求的 `Scheme` 与 `Host`，拼出完整 `https://api.example/avatars/...`。
   - 替换当前相对路径返回逻辑，使评论与回复的 `authorAvatarUrl` 全部返回绝对 URL。
   - 代码位置：`ASG.Api/Services/ArticleService.cs`（构造函数与 `GetAvatarUrl`、`MapToCommentDto`）。
2. 在 `Program.cs` 注册 `HttpContextAccessor`：
   - `builder.Services.AddHttpContextAccessor();`
   - 保持 `UseStaticFiles()`，确保 `/avatars/*` 可直接请求。

## 前端兜底（可选）
- 若需要在后端上线前先规避问题：
  - 在 `ArticleDetailView.vue` 对 `c.authorAvatarUrl` 做规范化：当它以 `/` 开头时，前缀为 API 的根域（`API_BASE_URL` 去掉 `/api`），形成绝对 URL，再传给 `v-img`。
  - 仅当后端短期仍返回相对路径时启用，后端上线后可移除该逻辑。

## 验证步骤
- 上传头像：`POST /api/Users/avatar` 成功后，访问文章详情并拉取评论。
- 检查接口返回：评论的 `authorAvatarUrl` 应为完整的 `http(s)://host/avatars/...`。
- 前端页面：评论与回复均显示头像；无头像时显示名字缩写。
- 生产环境额外检查：确保 API 域为 HTTPS，避免混合内容拦截。

## 影响范围与回滚
- 只影响评论头像的 URL 返回格式；不改动数据结构与存储位置。
- 若需回滚，移除 `IHttpContextAccessor` 使用并恢复相对路径生成即可。